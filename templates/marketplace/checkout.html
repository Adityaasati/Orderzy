{% extends 'base.html' %}
{% load static %}
{% load custom_filters %}
{% block title %} Checkout  {% endblock %} 
{% block content %}

<div class="main-section pt-5">

    <div class="page-section">
        <div class="container">
            <div class="row">

                <form action="{% url 'place_order' %}" method="POST">
                    {% csrf_token %}
                    <div class="col-lg-8 col-md-8 col-sm-8 col-xs-12">
                        <div class="tabs-holder horizontal">
                            <ul class="stickynav-tabs nav nav-tabs">
                                <li class="active"><a data-bs-toggle="tab" href="#preorder"><i
                                            class="icon- icon-room_service"></i> Pre-Order</a></li>
                            </ul>
                            <div class="tab-content">
                                <div id="preorder" class="tab-pane in active">
                                    <div class="pre-order-times">
                                        <div class="tab-content">
                                            <div id="preorder" class="tab-pane in active">
                                                <div class="pre-order-times">
                                                
                                                    <div class="menu-item-holder p-3">
                                                        <div class="btn-toolbar mb-3" role="toolbar" aria-label="Toolbar with button groups">
                                                            <div class="row w-100">
                                                                <div class="col-6 col-md-3 mb-2">
                                                                    <button type="button" class="btn btn-primary w-100 active pre-order-time"
                                                                        data-time="0" id="order-now" onclick="setActiveButton(this)">Order Now</button>
                                                                </div>
                                                                <div class="col-6 col-md-3 mb-2">
                                                                    <button type="button" class="btn btn-secondary w-100 pre-order-time"
                                                                        data-time="15" id="15-mins" onclick="setActiveButton(this)">15 mins</button>
                                                                </div>
                                                                <div class="col-6 col-md-3 mb-2">
                                                                    <button type="button" class="btn btn-secondary w-100 pre-order-time"
                                                                        data-time="30" id="30-mins" onclick="setActiveButton(this)">30 mins</button>
                                                                </div>
                                                                <div class="col-6 col-md-3 mb-2">
                                                                    <button type="button" class="btn btn-secondary w-100 pre-order-time"
                                                                        data-time="45" id="45-mins" onclick="setActiveButton(this)">45 mins</button>
                                                                </div>
                                                                <div class="col-6 col-md-3 mb-2">
                                                                    <button type="button" class="btn btn-secondary w-100 pre-order-time"
                                                                        data-time="60" id="1-hr" onclick="setActiveButton(this)">1 hr</button>
                                                                </div>
                                                                <div class="col-6 col-md-3 mb-2">
                                                                    <button type="button" class="btn btn-secondary w-100 pre-order-time"
                                                                        data-time="90" id="1.5-hrs" onclick="setActiveButton(this)">1.5 hrs</button>
                                                                </div>
                                                                <div class="col-6 col-md-3 mb-2">
                                                                    <button type="button" class="btn btn-secondary w-100 pre-order-time"
                                                                        data-time="120" id="2-hrs" onclick="setActiveButton(this)">2 hrs</button>
                                                                </div>
                                                            </div>
                                                            <input type="hidden" id="pre_order_time" name="pre_order_time" value="0">
                                                        </div>
                                                
                                                        
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg- col-md- col-sm-12 col-xs-12">
                        <div class="tabs-holder horizontal">
                            <ul class="stickynav-tabs nav nav-tabs">
                                <li class="active"><a data-bs-toggle="tab" href="#home"><i
                                            class="fa fa-shopping-cart text-danger"></i>Billing Address</a></li>

                            </ul>
                            <div class="tab-content">
                                <div id="home" class="tab-pane in active">
                                    <div class="menu-itam-holder">


                                        <div id="menu-item-list-6272" class="menu-itam-list">
                                            <div class="row">
                                                <div class="form-group col-md-6 col-sm-12 col-lg-6">
                                                    First Name: {{ form.first_name}}
                                                </div>
                                                <div class="form-group col-md-6 col-sm-12 col-lg-6">
                                                    Last Name: {{ form.last_name}}
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="form-group col-md-6 col-sm-12 col-lg-6">
                                                    Phone Number: {{ form.phone}}
                                                </div>
                                                <div class="form-group col-md-6 col-sm-12 col-lg-6">
                                                    Email Address: {{ form.email}}
                                                </div>
                                            </div>
                                            
                                            {% if seating_plan_available and num_of_restaurants == 1 %}
                                            <div class="row">
                                                <div class="form-group col-md-6 col-sm-12 col-lg-6">
                                                    Number of People: {{ form.num_of_people|add_class:"form-control" }}
                                                </div>
                                            </div>
                                            {%endif %}
                                        </div>

                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                    <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
                        <div class="tabs-holder horizontal">
                            <ul class="stickynav-tabs nav nav-tabs">
                                <li class="active"><a data-bs-toggle="tab" href="#home"><i
                                            class="icon- icon-room_service"></i>Your Order</a></li>
                                            

                            </ul>
                            <div class="tab-content">
                                <div id="home" class="tab-pane in active">
                                    <div class="menu-itam-holder">
                                       
                                        <div id="menu-item-list-6272" class="menu-item-list row">
                   
                                            <ul class="list-unstyled w-100">
                                                {% for cart_item in cart_items_with_totals %}
                                                <li id="cart-item-{{cart_item.item.id }}" class="d-flex align-items-center mb-3 row">
                                                    <!-- Image holder -->
                                                    {% if cart_item.item.fooditem.image %}
                                                    <div class="image-holder col-4 col-sm-2">
                                                        <img data-src="{{cart_item.item.fooditem.image.url}}" alt="Food Image" class="lazyload img-fluid rounded" loading="lazy" />
                                                    </div>
                                                    {% else %}
                                                    <img src="{% static 'images/bg3.png' %}" alt="Default Image" />
                                                    {% endif %}
                                                    
                                                    <!-- Text holder -->
                                                    <div class="text-holder col-8 col-sm-4">
                                                        <h6>{{cart_item.item.fooditem}}</h6>
                                                    </div>
                                            
                                                    <!-- Quantity Display -->
                                                    <div class="quantity-holder col-12 col-sm-3 d-flex align-items-center justify-content-center mt-2 mt-sm-0">
                                                        <span>{{cart_item.item.quantity}} Qty</span>
                                                    </div>
                                            
                                                    <!-- Price -->
                                                    <div class="price-holder col-12 col-sm-3 d-flex align-items-center justify-content-end mt-2 mt-sm-0">
                                                        <span class="price cart-above-mobile">₹{{cart_item.total_price}}</span>
                                                    </div>
                                                </li>
                                                {% endfor %}
                                            </ul>
                                            
                                            
                                          </div>
                                        
                                        <div>
                                            <ul class="list-unstyled">
                                                <li class="d-flex justify-content-between">
                                                    <span>Subtotal</span>
                                                    <span class="price">
                                                        <span class="currency">₹</span>
                                                        <span id="subtotal">{{subtotal}}</span>
                                                    </span>
                                                </li>
                                            
                                                {% for key, value in service_charge_dict.items %}
                                                    {% for i, j in value.items %}
                                                        <li class="d-flex justify-content-between">
                                                            <span>{{key}} </span>
                                                            <span class="price">
                                                                <span class="currency">₹</span>
                                                                <span id="tax-{{key}}">{{j}}</span>
                                                            </span>
                                                        </li>
                                                    {% endfor %}
                                                {% endfor %}
                                            
                                                <li class="d-flex justify-content-between fw-bold">
                                                    <span>Total</span>
                                                    <span class="price">
                                                        <span class="currency">₹</span>
                                                        <span id="total">{{grand_total}}</span>
                                                    </span>
                                                </li>
                                                <h5>SELECT PAYMENT METHOD</h5>
                                                <div class="payment-method">

                                                    <label>
                                                        <input type="radio" name="payment_method" value="PayPal" >
                                                        <img data-src="{% static 'images/PayPal.png' %}" alt="PayPal" class="lazyload"  loading="lazy"
                                                            width="100">
                                                    </label>
                                                    <label>
                                                        <input type="radio" name="payment_method" value="Cashfree" >
                                                        <img data-src="{% static 'images/Cashfree_P.png' %}" alt="Cashfree" class="lazyload"  loading="lazy"
                                                            width="100">
                                                    </label>
                                                    &nbsp;
                                                    {% if user.is_authenticated and user.role == 1 %}
                                                    <label>
                                                        <input type="radio" name="payment_method" value="Cash" >
                                                        <img data-src="{% static 'images/Cash.png' %}" alt="Cash"
                                                        width="100" class="lazyload"  loading="lazy">
                                                    </label>
                                                    {% endif %}


                                                </div>
                                                <span class="text-danger" id="payment-method-error"></span>

                                                <button onclick="return payMethodConfirm();" type="submit"
                                                    class="btn btn-danger w-100 p-2 mt-3">Place
                                                    Order</button>

                                            </ul>

                </form>
            </div>

        </div>
    </div>
</div>

</div>
</div>
</div>
</div>
</div>
</div>


<script>
    
    function setActiveButton(button) {
        // Remove active class from all buttons
        var buttons = document.querySelectorAll('.btn-toolbar .btn');
        buttons.forEach(function (btn) {
            btn.classList.remove('btn-primary', 'active');
            btn.classList.add('btn-secondary');
        });
        // Add active class to the clicked button
        button.classList.remove('btn-secondary');
        button.classList.add('btn-primary', 'active');
    }
    document.addEventListener('DOMContentLoaded', function () {
        const preOrderTimeButtons = document.querySelectorAll('.pre-order-time');
        const preOrderTimeInput = document.getElementById('pre_order_time');
        console.log("preOrderTimeButtons", preOrderTimeButtons)
        console.log("preOrderTimeInput", preOrderTimeInput)


        preOrderTimeButtons.forEach(button => {
            button.addEventListener('click', function () {
                // Update the hidden input with the selected time
                preOrderTimeInput.value = this.getAttribute('data-time');
                console.log("preOrderTimeInput.value",preOrderTimeInput.value)

                // Optionally update button styles to indicate selection
                preOrderTimeButtons.forEach(btn => btn.classList.remove('active'));
                this.classList.add('active');
            });
        }
        )
    })
    function payMethodConfirm() {
        var numOfPeopleInput = document.getElementById('id_num_of_people');

        if (numOfPeopleInput) {
            var numOfPeopleValue = numOfPeopleInput.value;


            if (!numOfPeopleValue || numOfPeopleValue <= 0) {
                alert('Please enter a valid number of people.');
                return false;  
            }}
    
        var payMethod = $("input[name= 'payment_method']:checked").val()
        console.log(payMethod)

        if (!payMethod) {
            $('#payment-method-error').html("Select Payment Method!")
            return false
        }
        else {
            var confMessage = payMethod === "Cash"
            ? "You have chosen to mark the payment as done. Click 'OK' to complete the order."
            : "You have selected " + payMethod + " as your preferred payment method.\nClick 'OK' to continue.";

            var conf = confirm(confMessage);
            return conf; 

        }

    }
    $('input[name=payment_method]').on('change', function () {
        $('payment-method-error').html("")
    })
</script>
{% endblock content %}
